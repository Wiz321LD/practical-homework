CREATE TABLE university_group(
    number INT PRIMARY KEY
);


CREATE TABLE student(
    student_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR NOT NULL,
    surname VARCHAR NOT NULL,
    birth_date DATE NOT NULL,
    group_number_fk INT REFERENCES university_group(number) ON DELETE SET NULL
);


CREATE TABLE teacher(
    teacher_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR NOT NULL,
    surname VARCHAR NOT NULL,
    birth_date DATE NOT NULL
);


CREATE TABLE student_teacher(
    student_id_fk INT REFERENCES student(student_id) ON DELETE CASCADE,
    teacher_id_fk INT REFERENCES teacher(teacher_id) ON DELETE CASCADE,
    PRIMARY KEY (student_id_fk, teacher_id_fk)
);


SELECT tea.teacher_id, stud.* FROM student AS stud
    JOIN student_teacher stteach ON stud.student_id = stteach.student_id_fk
    JOIN teacher tea ON stteach.teacher_id_fk = tea.teacher_id
WHERE tea.teacher_id = 3;


INSERT INTO university_group(number)
    VALUES (1),
           (2),
           (3),
           (4),
           (5);


INSERT INTO student(name, surname, birth_date, group_number_fk)
    VALUES ('Mike', 'Miller', '01-01-1998', 1),
           ('Milla', 'Miller', '01-02-1997', 1),
           ('Bart', 'Morton', '01-03-1999', 1),
           ('Andy', 'Nixon', '01-04-1999', 2),
           ('Mort', 'Davidson', '01-05-2000', 2),
           ('Alice', 'Miller', '01-06-1998', 3),
           ('Moira', 'Miller', '01-07-1998', 4),
           ('Jenna', 'Jackson', '01-08-1993', 5),
           ('Anna', 'Miller', '01-09-1995', 5),
           ('Mort', 'Miller', '01-02-1994', 5);


INSERT INTO teacher(name, surname, birth_date)
    VALUES ('Mike', 'Stone', '01-01-1983'),
           ('Veronica', 'Mils', '01-02-1983'),
           ('Kella', 'Stone', '01-03-1983'),
           ('Art', 'Mickelson', '01-04-1983'),
           ('Mort', 'Bound', '01-05-1983'),
           ('Alice', 'Mickelson', '01-06-1983'),
           ('Moira', 'Stone', '01-07-1983'),
           ('Jenna', 'Bound', '01-08-1983'),
           ('Jake', 'Bound', '01-09-1983'),
           ('Milla', 'Mils', '01-02-1983');


INSERT INTO student_teacher(student_id_fk, teacher_id_fk)
    VALUES (1, 1),
           (1, 2),
           (1, 3),
           (2, 4),
           (2, 5),
           (2, 6),
           (3, 7),
           (3, 8),
           (3, 9),
           (4, 10),
           (4, 1),
           (4, 2),
           (5, 3),
           (5, 4),
           (6, 5),
           (6, 6),
           (7, 7),
           (7, 8),
           (8, 9),
           (8, 10),
           (9, 1),
           (9, 2),
           (10, 3),
           (10, 4);


DROP TABLE university_group, teacher, student, student_teacher;


TRUNCATE TABLE university_group, teacher, student, student_teacher
    RESTART IDENTITY;